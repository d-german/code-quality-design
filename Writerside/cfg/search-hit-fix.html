<!-- cfg/search-hit-fix.html -->
<style>
    /* ────────────────────────────────────────────────────────────────
       1.  HIDE THE FOOTER
       ─────────────────────────────────────────────────────────────── */
    .app__footer { display: none !important; }
</style>

<script>
    (function () {
        /* ───────────────────────────────────────────────────────────────
             2.  QUICK-SEARCH TITLE CLEAN-UP  (remove “: undefined”)
        ─────────────────────────────────────────────────────────────── */
        const BAD = /\s*:\s*undefined\s*$/;
        function cleanTitle(el) {
            if (el && BAD.test(el.textContent))
                el.textContent = el.textContent.replace(BAD, '');
        }

        /* ───────────────────────────────────────────────────────────────
             3.  ADVANCED SEARCH  –  open …/index.html?s=full&q=TERM
             (button has data-test="full-search-button")
        ─────────────────────────────────────────────────────────────── */
        const BUTTON_SELECTOR =
            '[data-test="full-search-button"],' +       /* your button        */
            '.quick-search__advanced-link,' +           /* Writerside ≤6       */
            '.DocSearch-SeeAllResults,' +               /* Writerside 7        */
            'button[aria-label="See all results"]';     /* fallback            */

        /** Return the quick-search input element (6.x or 7.x). */
        const box = () =>
            document.querySelector(
                '.quick-search input[type="search"], ' +  /* 6.x */
                '.DocSearch-Search-Input'                 /* 7.x */
            );

        /** Base URL “…/<instance>/index.html” */
        function rootIndex() {
            return window.location.pathname.replace(/[^/]*$/, 'index.html');
        }

        /* Intercept every click on the Advanced-search button. */
        document.addEventListener('click', e => {
            const btn = e.target.closest(BUTTON_SELECTOR);
            if (!btn) return;           // some other click

            e.preventDefault();         // cancel Writerside’s handler
            const term = (box()?.value || '').trim();
            const url  = rootIndex() +
                (term ? `?s=full&q=${encodeURIComponent(term)}` : '?s=full');
            window.location.href = url;
        });

        /* ───────────────────────────────────────────────────────────────
             4.  OBSERVE DOM  –  keep cleaning titles that appear later
        ─────────────────────────────────────────────────────────────── */
        function init() {
            document.querySelectorAll('.quick-search__title').forEach(cleanTitle);

            const obs = new MutationObserver(muts =>
                muts.forEach(m =>
                    m.addedNodes.forEach(n =>
                        n.querySelectorAll?.('.quick-search__title').forEach(cleanTitle)
                    )
                )
            );
            obs.observe(document.body, { childList: true, subtree: true });
        }

        if (document.readyState === 'loading')
            document.addEventListener('DOMContentLoaded', init);
        else
            init();
    })();
</script>
