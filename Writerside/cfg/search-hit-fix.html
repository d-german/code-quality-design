<!-- cfg/search-hit-fix.html -->
<style>
    /* ────────────────────────────────────────────────────────────────
       1. REMOVE THE FOOTER
       ─────────────────────────────────────────────────────────────── */
    .app__footer { display: none !important; }
</style>

<script>
    (function () {
        /* ───────────────────────────────────────────────────────────────
             2. QUICK-SEARCH TITLES  – strip “: undefined”
        ──────────────────────────────────────────────────────────────── */
        const BAD = /\s*:\s*undefined\s*$/;
        function cleanTitle(el) {
            if (el && BAD.test(el.textContent))
                el.textContent = el.textContent.replace(BAD, '');
        }

        /* ───────────────────────────────────────────────────────────────
             3. ADVANCED SEARCH  – works with data-test="full-search-button"
        ──────────────────────────────────────────────────────────────── */
        const ADV_PAGE = 'search.html';

        /** current quick-search input (6 .x and 7 .x) */
        const box = () =>
            document.querySelector(
                '.quick-search input[type="search"],' +  /* Writerside 6 */
                '.DocSearch-Search-Input'                /* Writerside 7 */
            );

        /** intercept clicks on the Advanced-search button */
        document.addEventListener('click', e => {
            const adv = e.target.closest(
                '[data-test="full-search-button"],' +      /* ← your build */
                '.quick-search__advanced-link,' +          /* old 6.x */
                '[data-test="advanced-search-link"],' +    /* old 6.x */
                '.DocSearch-SeeAllResults,' +              /* 7.x */
                'button[aria-label="See all results"]'     /* fallback */
            );
            if (!adv) return;          /* click was elsewhere */

            e.preventDefault();        /* cancel Writerside’s handler */
            const term = (box()?.value || '').trim();
            const url  = term ? `${ADV_PAGE}?q=${encodeURIComponent(term)}`
                : ADV_PAGE;
            window.location.href = url;
        });

        /* ───────────────────────────────────────────────────────────────
             4. OBSERVE DOM – clean new titles that appear
        ──────────────────────────────────────────────────────────────── */
        function init() {
            document.querySelectorAll('.quick-search__title').forEach(cleanTitle);

            new MutationObserver(ms =>
                ms.forEach(m =>
                    m.addedNodes.forEach(n =>
                        n.querySelectorAll?.('.quick-search__title').forEach(cleanTitle)
                    )
                )
            ).observe(document.body, { childList: true, subtree: true });
        }

        document.readyState === 'loading'
            ? document.addEventListener('DOMContentLoaded', init)
            : init();
    })();
</script>
