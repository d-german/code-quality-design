<!-- cfg/search-hit-fix.html -->
<style>
    /* ────────────────────────────────────────────────────────────────
       1. HIDE THE FOOTER
       ─────────────────────────────────────────────────────────────── */
    .app__footer { display: none !important; }
</style>

<script>
    (function () {
        /* ───────────────────────────────────────────────────────────────
             2.  QUICK-SEARCH TITLE CLEAN-UP  (remove “: undefined”)
           ───────────────────────────────────────────────────────────── */
        const BAD = /\s*:\s*undefined\s*$/;

        function cleanTitle(el) {
            if (el && BAD.test(el.textContent))
                el.textContent = el.textContent.replace(BAD, '');
        }

        /* ───────────────────────────────────────────────────────────────
             3.  ADVANCED SEARCH  –   always open search.html?q=<term>
           ───────────────────────────────────────────────────────────── */
        const ADV_QUERY_PAGE = 'search.html';

        /** Returns the <input type=search> inside the quick-search dialog. */
        function searchBox() {
            return document.querySelector(
                '.quick-search input[type="search"], ' +                /* Writerside 6.x */
                '.DocSearch-Search-Input'                               /* Writerside 7.x */
            );
        }

        /** Global click hijack for the Advanced-search action. */
        document.addEventListener('click', e => {
            // Button is a <a> in Writerside ≤6, a <button> in ≥7; catch both
            const adv = e.target.closest(
                '.quick-search__advanced-link, ' +                       /* ≤6 */
                '[data-test="advanced-search-link"], ' +                 /* ≤6 */
                '.DocSearch-SeeAllResults, ' +                           /* ≥7 */
                'button[aria-label="See all results"]'                   /* fallback */
            );
            if (!adv) return;                // click was something else

            e.preventDefault();              // stop Writerside’s default handler
            const term = (searchBox()?.value || '').trim();
            const url  = ADV_QUERY_PAGE + (term ? '?q=' + encodeURIComponent(term) : '');
            window.location.href = url;      // navigate
        });

        /* ───────────────────────────────────────────────────────────────
             4.  OBSERVE CHANGES  –  keep cleaning new titles that appear
           ───────────────────────────────────────────────────────────── */
        function init() {
            document.querySelectorAll('.quick-search__title').forEach(cleanTitle);

            const obs = new MutationObserver(ms =>
                ms.forEach(m =>
                    m.addedNodes.forEach(node =>
                        node.querySelectorAll?.('.quick-search__title').forEach(cleanTitle)
                    )
                )
            );
            obs.observe(document.body, { childList: true, subtree: true });
        }

        if (document.readyState === 'loading')
            document.addEventListener('DOMContentLoaded', init);
        else
            init();
    })();
</script>
