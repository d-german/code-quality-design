<!-- cfg/search-hit-fix.html -->
<style>
    /*  HIDE THE FOOTER  --------------------------------------------------------
        Writerside wraps its powered-by block in <div class="app__footer …">.
        Setting display:none removes it on every page.                        */
    .app__footer { display: none !important; }
</style>

<script>
    (function () {
        /* ---------------------------------------------------------------
           1 / 3   CLEAN QUICK-SEARCH TITLES (“: undefined” issue)
        ----------------------------------------------------------------*/
        const BAD_SUFFIX = /\s*:\s*undefined\s*$/;

        function cleanTitle(el) {
            if (!el || !el.textContent) return;
            if (BAD_SUFFIX.test(el.textContent))
                el.textContent = el.textContent.replace(BAD_SUFFIX, '');
        }

        /* ---------------------------------------------------------------
           2 / 3   ADVANCED SEARCH – carry ?q=<current term>
        ----------------------------------------------------------------*/
        function wireAdvancedLink(panel) {
            const input = panel.querySelector('input[type="search"]');
            const link  = panel.querySelector('.quick-search__advanced-link');
            if (!input || !link) return;

            const update = () =>
                (link.href = `search.html?q=${encodeURIComponent(input.value.trim())}`);

            update();                       // set once
            input.addEventListener('input', update);   // keep in sync
        }

        /* ---------------------------------------------------------------
           3 / 3   INSTALL everything once the DOM is ready
        ----------------------------------------------------------------*/
        function init() {
            /* clean titles already present */
            document.querySelectorAll('.quick-search__title').forEach(cleanTitle);

            /* observe mutations: clean new titles + (re)wire advanced link */
            const obs = new MutationObserver(ms =>
                ms.forEach(m =>
                    m.addedNodes.forEach(n => {
                        n.querySelectorAll?.('.quick-search__title').forEach(cleanTitle);
                        if (n.classList?.contains('quick-search')) wireAdvancedLink(n);
                    })
                )
            );
            obs.observe(document.body, {childList: true, subtree: true});

            /* handle a panel that is already open */
            const openPanel = document.querySelector('.quick-search');
            if (openPanel) wireAdvancedLink(openPanel);

            /* Writerside fires this event whenever quick-search opens */
            document.addEventListener('DocSearch:autocomplete:afterOpen', e => {
                const p = e?.detail?.autocomplete?.state?.context?.panel?.el
                    || document.querySelector('.quick-search');
                if (p) wireAdvancedLink(p);
            });
        }

        if (document.readyState === 'loading')
            document.addEventListener('DOMContentLoaded', init);
        else
            init();
    })();
</script>
